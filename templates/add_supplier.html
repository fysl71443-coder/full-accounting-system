{% extends "base.html" %}

{% block title %}إضافة مورد جديد - نظام المحاسبة{% endblock %}
{% block page_title %}إضافة مورد جديد{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="fas fa-industry text-primary"></i> إضافة مورد جديد</h2>
                    <p class="text-muted">أدخل معلومات المورد الجديد</p>
                </div>
                <div>
                    <a href="/suppliers" class="btn btn-secondary">
                        <i class="fas fa-arrow-right"></i> العودة للموردين
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-industry"></i> معلومات المورد</h5>
                </div>
                <div class="card-body">
                    <form method="POST" id="supplierForm" action="{{ url_for('add_supplier') }}">
                        <!-- المعلومات الأساسية -->
                        <div class="form-section">
                            <div class="row">
                                <div class="col-12">
                                    <h6 class="form-section-title"><i class="fas fa-info-circle"></i> المعلومات الأساسية</h6>
                                </div>
                            </div>

                            <div class="row">
                                <!-- اسم المورد -->
                                <div class="col-md-6 mb-3">
                                    <label for="name" class="form-label form-label-enhanced">
                                        <i class="fas fa-building text-primary"></i> اسم المورد/الشركة
                                        <span class="required-indicator">*</span>
                                    </label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           placeholder="أدخل اسم المورد أو الشركة">
                                    <div class="invalid-feedback">
                                        يرجى إدخال اسم المورد
                                    </div>
                                    <div class="form-help">أدخل الاسم الرسمي للمورد أو الشركة</div>
                                </div>

                            <!-- نوع النشاط -->
                            <div class="col-md-6 mb-3">
                                <label for="business_type" class="form-label">
                                    <i class="fas fa-tag text-info"></i> نوع النشاط
                                </label>
                                <select class="form-select" id="business_type" name="business_type">
                                    <option value="">اختر نوع النشاط</option>
                                    <option value="materials">مواد خام</option>
                                    <option value="services">خدمات</option>
                                    <option value="equipment">معدات</option>
                                    <option value="technology">تقنية</option>
                                    <option value="consulting">استشارات</option>
                                    <option value="manufacturing">تصنيع</option>
                                    <option value="logistics">لوجستيات</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <!-- رقم التسجيل التجاري -->
                            <div class="col-md-6 mb-3">
                                <label for="commercial_register" class="form-label">
                                    <i class="fas fa-certificate text-warning"></i> رقم التسجيل التجاري
                                </label>
                                <input type="text" class="form-control" id="commercial_register" name="commercial_register"
                                       placeholder="رقم السجل التجاري">
                            </div>

                            <!-- الرقم الضريبي -->
                            <div class="col-md-6 mb-3">
                                <label for="tax_number" class="form-label">
                                    <i class="fas fa-percentage text-success"></i> الرقم الضريبي
                                </label>
                                <input type="text" class="form-control" id="tax_number" name="tax_number"
                                       placeholder="الرقم الضريبي للمورد">
                            </div>
                        </div>

                        <!-- معلومات الاتصال -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3"><i class="fas fa-phone"></i> معلومات الاتصال</h6>
                            </div>
                        </div>

                        <div class="row">
                            <!-- رقم الهاتف الرئيسي -->
                            <div class="col-md-4 mb-3">
                                <label for="phone" class="form-label">
                                    <i class="fas fa-phone text-success"></i> رقم الهاتف الرئيسي
                                </label>
                                <input type="tel" class="form-control" id="phone" name="phone"
                                       placeholder="05xxxxxxxx">
                            </div>

                            <!-- رقم الفاكس -->
                            <div class="col-md-4 mb-3">
                                <label for="fax" class="form-label">
                                    <i class="fas fa-fax text-info"></i> رقم الفاكس
                                </label>
                                <input type="tel" class="form-control" id="fax" name="fax"
                                       placeholder="رقم الفاكس">
                            </div>

                            <!-- البريد الإلكتروني -->
                            <div class="col-md-4 mb-3">
                                <label for="email" class="form-label">
                                    <i class="fas fa-envelope text-warning"></i> البريد الإلكتروني
                                </label>
                                <input type="email" class="form-control" id="email" name="email"
                                       placeholder="supplier@example.com">
                            </div>
                        </div>

                        <div class="row">
                            <!-- الموقع الإلكتروني -->
                            <div class="col-md-6 mb-3">
                                <label for="website" class="form-label">
                                    <i class="fas fa-globe text-primary"></i> الموقع الإلكتروني
                                </label>
                                <input type="url" class="form-control" id="website" name="website"
                                       placeholder="https://www.example.com">
                            </div>

                            <!-- معلومات الاتصال الإضافية -->
                            <div class="col-md-6 mb-3">
                                <label for="contact_info" class="form-label">
                                    <i class="fas fa-address-book text-secondary"></i> معلومات اتصال إضافية
                                </label>
                                <input type="text" class="form-control" id="contact_info" name="contact_info"
                                       placeholder="أي معلومات اتصال إضافية">
                            </div>
                        </div>

                        <!-- العنوان -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3"><i class="fas fa-map-marker-alt"></i> العنوان</h6>
                            </div>
                        </div>

                        <div class="row">
                            <!-- العنوان التفصيلي -->
                            <div class="col-md-8 mb-3">
                                <label for="address" class="form-label">
                                    <i class="fas fa-map-marker-alt text-danger"></i> العنوان التفصيلي
                                </label>
                                <textarea class="form-control" id="address" name="address" rows="3"
                                          placeholder="أدخل العنوان التفصيلي للمورد"></textarea>
                            </div>

                            <!-- المدينة -->
                            <div class="col-md-4 mb-3">
                                <label for="city" class="form-label">
                                    <i class="fas fa-city text-info"></i> المدينة
                                </label>
                                <input type="text" class="form-control" id="city" name="city"
                                       placeholder="المدينة">
                            </div>
                        </div>

                        <div class="row">
                            <!-- الدولة -->
                            <div class="col-md-6 mb-3">
                                <label for="country" class="form-label">
                                    <i class="fas fa-flag text-success"></i> الدولة
                                </label>
                                <select class="form-select" id="country" name="country">
                                    <option value="">اختر الدولة</option>
                                    <option value="SA" selected>المملكة العربية السعودية</option>
                                    <option value="AE">الإمارات العربية المتحدة</option>
                                    <option value="KW">الكويت</option>
                                    <option value="QA">قطر</option>
                                    <option value="BH">البحرين</option>
                                    <option value="OM">عمان</option>
                                    <option value="JO">الأردن</option>
                                    <option value="EG">مصر</option>
                                    <option value="other">أخرى</option>
                                </select>
                            </div>

                            <!-- الرمز البريدي -->
                            <div class="col-md-6 mb-3">
                                <label for="postal_code" class="form-label">
                                    <i class="fas fa-mail-bulk text-secondary"></i> الرمز البريدي
                                </label>
                                <input type="text" class="form-control" id="postal_code" name="postal_code"
                                       placeholder="الرمز البريدي">
                            </div>
                        </div>

                        <!-- معلومات إضافية -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h6 class="text-primary mb-3"><i class="fas fa-cogs"></i> معلومات إضافية</h6>
                            </div>
                        </div>

                        <div class="row">
                            <!-- شروط الدفع -->
                            <div class="col-md-4 mb-3">
                                <label for="payment_terms" class="form-label">
                                    <i class="fas fa-handshake text-success"></i> شروط الدفع
                                </label>
                                <select class="form-select" id="payment_terms" name="payment_terms">
                                    <option value="cash">نقداً</option>
                                    <option value="30_days">30 يوم</option>
                                    <option value="60_days">60 يوم</option>
                                    <option value="90_days">90 يوم</option>
                                    <option value="custom">مخصص</option>
                                </select>
                            </div>

                            <!-- العملة المفضلة -->
                            <div class="col-md-4 mb-3">
                                <label for="currency" class="form-label">
                                    <i class="fas fa-money-bill text-warning"></i> العملة المفضلة
                                </label>
                                <select class="form-select" id="currency" name="currency">
                                    <option value="SAR" selected>ريال سعودي (SAR)</option>
                                    <option value="USD">دولار أمريكي (USD)</option>
                                    <option value="EUR">يورو (EUR)</option>
                                    <option value="AED">درهم إماراتي (AED)</option>
                                </select>
                            </div>

                            <!-- التقييم الأولي -->
                            <div class="col-md-4 mb-3">
                                <label for="rating" class="form-label">
                                    <i class="fas fa-star text-warning"></i> التقييم الأولي
                                </label>
                                <select class="form-select" id="rating" name="rating">
                                    <option value="5">ممتاز (5 نجوم)</option>
                                    <option value="4" selected>جيد جداً (4 نجوم)</option>
                                    <option value="3">جيد (3 نجوم)</option>
                                    <option value="2">مقبول (2 نجوم)</option>
                                    <option value="1">ضعيف (1 نجمة)</option>
                                </select>
                            </div>
                        </div>

                        <div class="row">
                            <!-- ملاحظات -->
                            <div class="col-12 mb-4">
                                <label for="notes" class="form-label">
                                    <i class="fas fa-sticky-note text-secondary"></i> ملاحظات
                                </label>
                                <textarea class="form-control" id="notes" name="notes" rows="3"
                                          placeholder="أي ملاحظات إضافية عن المورد"></textarea>
                            </div>
                        </div>

                        <!-- أزرار الإجراءات -->
                        <div class="form-actions">
                            <div class="row">
                                <div class="col-12">
                                    <div class="btn-group-enhanced">
                                        <button type="button" class="btn btn-outline-secondary btn-enhanced" onclick="history.back()">
                                            <i class="fas fa-times"></i> إلغاء
                                        </button>
                                        <button type="button" class="btn btn-outline-warning btn-enhanced undo-btn" disabled>
                                            <i class="fas fa-undo"></i> تراجع
                                        </button>
                                        <button type="button" class="btn btn-outline-info btn-enhanced" onclick="autoSaveForm(document.getElementById('supplierForm'))">
                                            <i class="fas fa-cloud"></i> حفظ تلقائي
                                        </button>
                                        <button type="submit" class="btn btn-primary btn-enhanced save-btn">
                                            <i class="fas fa-save"></i> حفظ المورد
                                        </button>
                                    </div>

                                    <!-- مؤشر الحالة -->
                                    <div class="mt-3 text-center">
                                        <small class="text-muted">
                                            <i class="fas fa-lock"></i> البيانات محفوظة بشكل آمن ومشفر
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// التحقق السريع من صحة النموذج
document.getElementById('supplierForm').addEventListener('submit', function(e) {
    const name = document.getElementById('name').value.trim();

    if (!name) {
        e.preventDefault();
        document.getElementById('name').classList.add('is-invalid');
        FastFormProcessor.showQuickMessage('يرجى إدخال اسم المورد', 'danger');
        return false;
    }

    // معالجة سريعة للزر
    const submitBtn = this.querySelector('button[type="submit"]');
    if (submitBtn) {
        submitBtn.innerHTML = '<i class="fas fa-check"></i> تم الحفظ';
        submitBtn.disabled = true;
    }
});

// إزالة رسالة الخطأ عند الكتابة
document.getElementById('name').addEventListener('input', function() {
    this.classList.remove('is-invalid');
});

// تنسيق رقم الهاتف
document.getElementById('phone').addEventListener('input', function() {
    let value = this.value.replace(/\D/g, '');
    if (value.length > 10) {
        value = value.substring(0, 10);
    }
    this.value = value;
});
</script>
{% endblock %}
